---
interface Props {
  targetId?: string;
  isOpen?: boolean;
}

const { targetId = "primary-menu", isOpen = false } = Astro.props;
---

<button
  class="ham ham-rotate"
  aria-label="Toggle navigation"
  aria-controls={targetId}
  aria-expanded={isOpen}
  type="button"
>
  <svg viewBox="0 0 100 100" width="55" height="55">
    <path
      class="ham-line ham-line-top"
      d="m 30,33 h 40 c 0,0 9.044436,-0.654587 9.044436,-8.508902 0,-7.854315 -8.024349,-11.958003 -14.89975,-10.85914 -6.875401,1.098863 -13.637059,4.171617 -13.637059,16.368042 v 40"
    ></path>
    <path class="ham-line ham-line-middle" d="m 30,50 h 40"></path>
    <path
      class="ham-line ham-line-bottom"
      d="m 30,67 h 40 c 12.796276,0 15.357889,-11.717785 15.357889,-26.851538 0,-15.133752 -4.786586,-27.274118 -16.667516,-27.274118 -11.88093,0 -18.499247,6.994427 -18.435284,17.125656 l 0.252538,40"
    ></path>
  </svg>
</button>

<style>
  .ham {
    cursor: pointer;
    transition: transform 400ms;
    user-select: none;
    background: none;
    border: none;
    color: #dbd3c8;
  }

  .ham-rotate.active {
    transform: rotate(45deg);
  }

  .ham-line {
    fill: none;
    transition:
      stroke-dasharray 400ms,
      stroke-dashoffset 400ms;
    stroke: currentColor;
    stroke-width: 5.5;
    stroke-linecap: round;
  }

  .ham-line-top {
    stroke-dasharray: 40 139;
    stroke-dashoffset: 0.5;
  }

  .ham-line-bottom {
    stroke-dasharray: 40 180;
    stroke-dashoffset: -0.5;
  }

  .ham-rotate.active .ham-line-top {
    stroke-dashoffset: -98px;
  }

  .ham-rotate.active .ham-line-bottom {
    stroke-dashoffset: -138px;
  }

  @media (min-width: 992px) {
    .ham {
      display: none;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .ham {
      transition: none;
    }

    .ham-line {
      transition: none;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const hamburger = document.querySelector(".ham");
    const targetId = hamburger?.getAttribute("aria-controls");
    const targetMenu = targetId ? document.getElementById(targetId) : null;

    if (!hamburger || !targetMenu) return;

    if (!targetMenu) {
      console.warn(`Hamburger menu: Target element #${targetId} not found`);
      return;
    }

    // Function to reset menu state on desktop
    const resetMenuForDesktop = () => {
      if (window.innerWidth >= 768) {
        hamburger.classList.remove("active");
        hamburger.setAttribute("aria-expanded", "false");
        targetMenu.classList.remove("active");
        targetMenu.setAttribute("aria-hidden", "true");
      }
    };

    // Initial reset
    resetMenuForDesktop();

    // Hamburger click handler
    hamburger.addEventListener("click", () => {
      const isExpanded = hamburger.classList.toggle("active");
      hamburger.setAttribute("aria-expanded", isExpanded.toString());
      targetMenu.classList.toggle("active");
      targetMenu.setAttribute("aria-hidden", (!isExpanded).toString());
    });

    // Reset on window resize
    window.addEventListener("resize", resetMenuForDesktop);
  });
</script>
