---
import Dropdown from "../ui/NavDropdown.astro";
import Button from "../ui/Button.astro";
import Hamburger from "../ui/Hamburger.astro";

import { productLinks } from "../../data/dropdown-data";
---

<a href="#main-content" class="skip-link">Skip to main content</a>
<nav class="nav-bar" role="navigation" aria-label="Main">
  <div class="nav-bar__container">
    <a href="/" class="nav-bar__logo" aria-label="Home">
      <img src="/images/Logo.svg" alt="Company logo" height="48" width="117" />
    </a>
    <Hamburger targetId="primary-menu" />
    <div class="nav-bar__links" id="primary-menu" aria-hidden="true">
      <ul>
        <li>
          <a href="/" class="nav-bar__link" aria-current="page">Home</a>
        </li>
        <Dropdown
          triggerText="Products"
          triggerHref="/products"
          links={productLinks}
        />
        <li><a href="/services" class="nav-bar__link">Services</a></li>
        <li><a href="/about" class="nav-bar__link">About</a></li>
        <!-- <li><a href="/projects" class="nav-bar__link">Gallery</a></li> -->
        <li><a href="/contact" class="nav-bar__link">Contact</a></li>
        <li class="nav-bar__book-now">
          <Button href="/contact#contact-form" color="nav"
            >Get a Free Quote</Button
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<style>
  .skip-link {
    position: absolute;
    top: -40px;
    left: 6px;
    background: var(--primary);
    color: white;
    padding: 8px 12px;
    text-decoration: none;
    z-index: 10000;
    border-radius: 2px;
  }

  .skip-link:focus {
    top: 6px;
    outline: 2px solid var(--neutral);
  }
  nav {
    position: sticky;
    top: 0;
    background-color: var(--primary);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 72px;
    width: 100%;
    z-index: 1000;
  }

  .nav-bar__container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 1300px;
    height: 100%;
    padding: clamp(12px, 2vw, 16px) clamp(16px, 5vw, 64px);
  }

  .nav-bar__logo {
    display: flex;
    justify-content: center;
    align-items: center;
    height: auto;
  }
  .nav-bar__logo img {
    height: 48px;
    width: auto;
  }

  /* --- Mobile nav (default) --- */

  .nav-bar__backdrop {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    z-index: 998;
  }

  @media (max-width: 767px) {
    .nav-bar__links[aria-hidden="false"] ~ .nav-bar__backdrop {
      display: block;
    }
  }

  .nav-bar__links {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 72px;
    left: 0;
    width: 100%;
    background-color: var(--white);
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    padding: 0;
    transition:
      max-height 0.4s ease,
      opacity 0.4s ease,
      padding 0.3s ease;
    box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
  }

  .nav-bar__links.active {
    max-height: calc(100vh - 72px);
    opacity: 1;
    overflow-y: auto;
  }

  :global(.nav-bar__links > ul > li) {
    width: 100%;
    padding: 20px 16px;
    border-bottom: 1px solid var(--grey-10);
  }
  :global(.nav-bar__dropdown-menu li:last-child) {
    border-bottom: none;
  }

  :global(.nav-bar__links .nav-bar__link) {
    display: flex;
    align-items: center;
    justify-content: start;
    padding: 10px 0;
    font-size: 1.3rem;
    font-weight: 500;
    color: var(--text);
  }

  :global(.nav-bar__links .nav-bar__link:hover) {
    color: var(--primary);
  }

  .nav-bar__link.active {
    color: var(--neutral);
  }

  .nav-bar__links .nav-bar__book-now {
    margin-top: auto;
    margin-left: 20px;
    padding: 30px 16px;
  }

  /* --- Media Queries --- */

  @media (min-width: 950px) {
    nav {
      height: 104px;
    }

    .nav-bar__logo {
      height: 100%;
    }

    .nav-bar__logo img {
      height: 100%;
      width: auto;
    }

    .nav-bar__links {
      position: static;
      max-height: none;
      opacity: 1;
      overflow: visible;
      flex-direction: row;
      background-color: transparent;
      box-shadow: none;
      width: auto;
      padding: 0;
    }

    .nav-bar__links ul {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 2px;
      width: auto;
    }

    :global(.nav-bar__links > ul > li) {
      width: auto;
      padding: 0;
      border-bottom: none;
    }

    :global(.nav-bar__links .nav-bar__link) {
      font-size: 1rem;
      justify-content: center;
      padding: 8px 12px;
      color: var(--white);
    }

    :global(.nav-bar__links .nav-bar__link:hover) {
      color: var(--neutral-light);
    }

    .nav-bar__link.active {
      color: var(--neutral) !important;
    }

    .nav-bar__links .nav-bar__book-now {
      margin-top: 0;
      padding: 0;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Active page highlighting only
    const links = document.querySelectorAll(".nav-bar__link");

    function highlightActivePage() {
      const currentPath = window.location.pathname;

      links.forEach((link) => {
        const href = link.getAttribute("href");

        if (!href) return;

        // Handle relative URLs
        const fullUrl = href.startsWith("http")
          ? href
          : `${window.location.origin}${href.startsWith("/") ? href : `/${href}`}`;

        try {
          const linkUrl = new URL(fullUrl);

          if (linkUrl.pathname === currentPath) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        } catch (error) {
          console.warn("Invalid URL:", href);
        }
      });
    }

    // Only run if we have links
    if (links.length > 0) {
      highlightActivePage();
    }
  });
</script>
